import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{$ as t,B as n,C as r,D as i,E as ee,G as a,H as te,K as o,N as ne,O as re,Q as s,R as ie,T as c,V as ae,W as l,Z as u,at as oe,et as d,g as f,h as p,ht as m,it as h,j as se,m as g,n as ce,pt as _,q as v,rt as y,s as le,t as ue,tt as b,y as x}from"./mui-Ec-9_KFF.js";import{a as S}from"./vendor-CfXIGJNW.js";import"./supabase-O-LofRAx.js";import{n as C,t as de}from"./index-CxN0Tboc.js";var w=e(m()),T=e(_()),E=()=>{let{user:e,logout:m}=de(),_=S(),[E,D]=(0,w.useState)([]),[O,fe]=(0,w.useState)([]),[k,pe]=(0,w.useState)(0),[me,A]=(0,w.useState)(!1),[j,M]=(0,w.useState)(null),[N,P]=(0,w.useState)({show:!1,message:``,type:`success`}),[F,I]=(0,w.useState)({titulo:``,subtitulo:``,contenido:``,imagen:``,categoria:``}),[L,he]=(0,w.useState)([]),[ge,R]=(0,w.useState)(!1),[z,B]=(0,w.useState)(null),[V,H]=(0,w.useState)({nombre:``,descripcion:``,estado:!0});(0,w.useEffect)(()=>{if(!e||e.role!==`editor`){_(`/login`);return}U(),W(),G()},[e,_]);let U=async()=>{try{let{data:e,error:t}=await C.from(`posts`).select(`*`).in(`estado`,[`Terminado`,`Publicado`,`Desactivado`]).order(`fechacreacion`,{ascending:!1});if(t)throw t;if(e&&e.length>0){let{data:t}=await C.from(`secciones`).select(`*`),n=e.map(e=>{let n=t?.find(t=>t.idseccion===e.categoria);return{...e,secciones:n?{nombre:n.nombre}:null}});D(n)}else D([])}catch(e){console.error(`Error al cargar noticias:`,e),K(`Error al cargar noticias: `+e.message,`error`)}},W=async()=>{try{let{data:e,error:t}=await C.from(`secciones`).select(`*`).eq(`estado`,!0);if(t)throw t;fe(e||[])}catch(e){console.error(`Error al cargar secciones:`,e)}},G=async()=>{try{let{data:e,error:t}=await C.from(`secciones`).select(`*`).order(`nombre`,{ascending:!0});if(t)throw t;he(e||[])}catch(e){console.error(`Error al cargar secciones (admin):`,e)}},K=(e,t=`success`)=>{P({show:!0,message:e,type:t}),setTimeout(()=>P({show:!1,message:``,type:`success`}),4e3)},q=(e=null)=>{e?(B(e),H({nombre:e.nombre||``,descripcion:e.descripcion||``,estado:e.estado!==!1})):(B(null),H({nombre:``,descripcion:``,estado:!0})),R(!0)},J=()=>{R(!1),B(null),H({nombre:``,descripcion:``,estado:!0})},_e=async()=>{if(!V.nombre.trim()){K(`El nombre de la sección es obligatorio`,`error`);return}try{if(z){let{error:e}=await C.from(`secciones`).update({nombre:V.nombre.trim(),descripcion:V.descripcion.trim(),estado:!!V.estado}).eq(`idseccion`,z.idseccion);if(e)throw e;K(`Sección actualizada correctamente`)}else{let{error:e}=await C.from(`secciones`).insert([{nombre:V.nombre.trim(),descripcion:V.descripcion.trim(),estado:!!V.estado}]);if(e)throw e;K(`Sección creada correctamente`)}J(),G(),W()}catch(e){console.error(`Error guardando sección:`,e),K(`Error guardando la sección`,`error`)}},ve=async e=>{try{let{error:t}=await C.from(`secciones`).update({estado:!e.estado}).eq(`idseccion`,e.idseccion);if(t)throw t;G(),W()}catch{K(`Error al cambiar estado de la sección`,`error`)}},ye=async e=>{if(window.confirm(`¿Eliminar la sección "${e.nombre}"?`))try{let{count:t,error:n}=await C.from(`posts`).select(`id`,{count:`exact`}).eq(`categoria`,e.idseccion);if(n)throw n;if((t||0)>0){K(`No se puede eliminar: hay noticias asociadas a esta sección`,`error`);return}let{error:r}=await C.from(`secciones`).delete().eq(`idseccion`,e.idseccion);if(r)throw r;K(`Sección eliminada`),G(),W()}catch(e){console.error(`Error eliminando sección:`,e),K(`Error eliminando la sección`,`error`)}},Y=(e,t=`view`)=>{if(M({...e,mode:t}),t===`edit`){let t=O.find(t=>t.idseccion===e.categoria);I({titulo:e.titulo,subtitulo:e.subtitulo||``,contenido:e.contenido,imagen:e.imagen||``,categoria:t?.nombre||``})}A(!0)},X=()=>{A(!1),M(null),I({titulo:``,subtitulo:``,contenido:``,imagen:``,categoria:``})},be=async e=>{try{let{error:t}=await C.from(`posts`).update({estado:`Publicado`,fechaactualizacion:new Date().toISOString()}).eq(`id`,e);if(t)throw console.error(`Error detallado:`,t),t;K(`Noticia publicada correctamente`),U()}catch(e){console.error(`Error al publicar:`,e),K(`Error al publicar noticia: `+(e.message||`Error desconocido`),`error`)}},xe=async e=>{try{let{error:t}=await C.from(`posts`).update({estado:`Desactivado`}).eq(`id`,e);if(t)throw t;K(`Noticia desactivada correctamente`),U()}catch(e){console.error(`Error al desactivar:`,e),K(`Error al desactivar noticia`,`error`)}},Se=async e=>{if(window.confirm(`¿Estás seguro de que deseas eliminar esta noticia? Esta acción no se puede deshacer.`))try{let{error:t}=await C.from(`posts`).delete().eq(`id`,e);if(t)throw t;K(`Noticia eliminada correctamente`),U()}catch(e){console.error(`Error al eliminar:`,e),K(`Error al eliminar noticia`,`error`)}},Ce=async()=>{if(!F.titulo||!F.contenido||!F.categoria){K(`Por favor completa los campos requeridos`,`error`);return}try{let e=O.find(e=>e.nombre===F.categoria),{error:t}=await C.from(`posts`).update({titulo:F.titulo,subtitulo:F.subtitulo,contenido:F.contenido,imagen:F.imagen,categoria:e?.idseccion||null,fechaactualizacion:new Date().toISOString()}).eq(`id`,j.id);if(t)throw t;K(`Noticia actualizada correctamente`),X(),U()}catch(e){console.error(`Error al actualizar:`,e),K(`Error al actualizar noticia`,`error`)}},we=async()=>{await m(),_(`/login`)},Te=e=>{let t={Edicion:{label:`En Edición`,color:`default`,icon:null},Terminado:{label:`Terminado`,color:`info`,icon:null},Publicado:{label:`Publicado`,color:`success`,icon:(0,T.jsx)(f,{})},Desactivado:{label:`Desactivado`,color:`error`,icon:(0,T.jsx)(x,{})}}[e]||{label:`Desconocido`,color:`default`,icon:null};return(0,T.jsx)(y,{label:t.label,color:t.color,size:`small`,icon:t.icon})},Z=E.filter(e=>e.estado===`Terminado`||e.estado===`Desactivado`),Q=E.filter(e=>e.estado===`Publicado`),$=k===0?Z:Q;return(0,T.jsxs)(b,{className:`panel-editor`,children:[(0,T.jsxs)(b,{className:`panel-header`,children:[(0,T.jsxs)(b,{className:`header-content`,children:[(0,T.jsx)(ce,{sx:{fontSize:40,color:`#ffd700`}}),(0,T.jsxs)(b,{children:[(0,T.jsx)(h,{variant:`h4`,sx:{color:`#ffd700`,fontWeight:700},children:`Panel de Editor`}),(0,T.jsxs)(h,{variant:`body2`,sx:{color:`#999`},children:[`Bienvenido, `,e?.nombre]})]})]}),(0,T.jsx)(d,{variant:`outlined`,startIcon:(0,T.jsx)(le,{}),onClick:we,sx:{borderColor:`#ffd700`,color:`#ffd700`,"&:hover":{borderColor:`#ffed4e`,backgroundColor:`rgba(255, 215, 0, 0.1)`}},children:`Cerrar Sesión`})]}),N.show&&(0,T.jsx)(oe,{severity:N.type,sx:{mb:3},children:N.message}),(0,T.jsxs)(b,{className:`panel-content`,children:[(0,T.jsxs)(ee,{value:k,onChange:(e,t)=>pe(t),variant:`scrollable`,scrollButtons:`auto`,allowScrollButtonsMobile:!0,sx:{mb:3,minHeight:44,"& .MuiTab-root":{color:`#999`,fontWeight:600,minWidth:`fit-content`,px:2,minHeight:44},"& .Mui-selected":{color:`#ffd700`},"& .MuiTabs-indicator":{backgroundColor:`#ffd700`},"& .MuiTabs-scrollButtons":{color:`#ffd700`,alignSelf:`center`,height:44}},children:[(0,T.jsx)(i,{label:`Pendientes (${Z.length})`}),(0,T.jsx)(i,{label:`Publicadas (${Q.length})`}),(0,T.jsx)(i,{label:`Secciones (${L.length})`})]}),k===2?(0,T.jsxs)(b,{children:[(0,T.jsxs)(b,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:2},children:[(0,T.jsx)(h,{variant:`h6`,sx:{color:`#ffd700`,fontWeight:700},children:`Administrar Secciones`}),(0,T.jsx)(d,{variant:`contained`,startIcon:(0,T.jsx)(r,{}),onClick:()=>q(null),sx:{background:`linear-gradient(90deg, #ffd700, #ffb200)`,color:`#000`,fontWeight:700,"&:hover":{background:`linear-gradient(90deg, #ffed4e, #ffd700)`}},children:`Nueva sección`})]}),L.length===0?(0,T.jsx)(h,{sx:{color:`#999`,textAlign:`center`,py:4},children:`No hay secciones registradas`}):(0,T.jsx)(n,{container:!0,spacing:3,className:`panel-grid`,children:L.map(e=>(0,T.jsx)(n,{item:!0,xs:12,md:6,lg:4,sx:{display:`flex`},children:(0,T.jsxs)(t,{className:`noticia-card`,sx:{width:`100%`,maxWidth:380,mx:`auto`},children:[(0,T.jsxs)(u,{children:[(0,T.jsx)(b,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:1},children:(0,T.jsx)(y,{label:e.estado?`Activa`:`Inactiva`,color:e.estado?`success`:`default`,size:`small`})}),(0,T.jsx)(h,{variant:`h6`,sx:{color:`#ffd700`,fontWeight:700,mb:1},children:e.nombre}),(0,T.jsx)(h,{variant:`body2`,sx:{color:`#999`,mb:1},children:e.descripcion||`Sin descripción`})]}),(0,T.jsxs)(s,{sx:{gap:1,flexWrap:`wrap`},children:[(0,T.jsx)(d,{size:`small`,startIcon:(0,T.jsx)(g,{}),onClick:()=>q(e),sx:{color:`#4CAF50`,"&:hover":{backgroundColor:`rgba(76, 175, 80, 0.1)`}},children:`Editar`}),(0,T.jsx)(d,{size:`small`,startIcon:e.estado?(0,T.jsx)(x,{}):(0,T.jsx)(f,{}),onClick:()=>ve(e),sx:{color:e.estado?`#f44336`:`#4CAF50`,"&:hover":{backgroundColor:e.estado?`rgba(244, 67, 54, 0.1)`:`rgba(76, 175, 80, 0.1)`}},children:e.estado?`Desactivar`:`Activar`}),(0,T.jsx)(d,{size:`small`,startIcon:(0,T.jsx)(p,{}),onClick:()=>ye(e),sx:{color:`#ff6b6b`,"&:hover":{backgroundColor:`rgba(255, 107, 107, 0.1)`,color:`#ff5252`}},children:`Eliminar`})]})]})},e.idseccion))})]}):(0,T.jsx)(n,{container:!0,spacing:3,className:`panel-grid`,children:$.length===0?(0,T.jsx)(n,{item:!0,xs:12,children:(0,T.jsx)(h,{sx:{color:`#999`,textAlign:`center`,py:4},children:k===0?`No hay noticias pendientes`:`No hay noticias publicadas`})}):$.map(e=>(0,T.jsx)(n,{item:!0,xs:12,md:6,lg:4,sx:{display:`flex`},children:(0,T.jsxs)(t,{className:`noticia-card`,sx:{width:`100%`,maxWidth:380,mx:`auto`},children:[(0,T.jsxs)(u,{children:[(0,T.jsxs)(b,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,gap:2,mb:1},children:[Te(e.estado),(0,T.jsx)(y,{label:e.secciones?.nombre||`Sin sección`,size:`small`,sx:{backgroundColor:`#333`,color:`#ffd700`}})]}),(0,T.jsx)(h,{variant:`h6`,sx:{color:`#ffd700`,fontWeight:700,mb:1},children:e.titulo}),(0,T.jsx)(h,{variant:`body2`,sx:{color:`#999`,mb:1},children:e.subtitulo}),(0,T.jsxs)(h,{variant:`caption`,sx:{color:`#666`,display:`block`},children:[`Autor: `,e.autor]}),(0,T.jsxs)(h,{variant:`caption`,sx:{color:`#666`},children:[`Creada: `,new Date(e.fechacreacion).toLocaleDateString()]})]}),(0,T.jsxs)(s,{sx:{gap:1,flexWrap:`wrap`},children:[(0,T.jsx)(d,{size:`small`,startIcon:(0,T.jsx)(ue,{}),onClick:()=>Y(e,`view`),sx:{color:`#ffd700`,"&:hover":{backgroundColor:`rgba(255, 215, 0, 0.1)`}},children:`Ver`}),(0,T.jsx)(d,{size:`small`,startIcon:(0,T.jsx)(g,{}),onClick:()=>Y(e,`edit`),sx:{color:`#4CAF50`,"&:hover":{backgroundColor:`rgba(76, 175, 80, 0.1)`}},children:`Editar`}),e.estado===`Publicado`?(0,T.jsx)(d,{size:`small`,startIcon:(0,T.jsx)(x,{}),onClick:()=>xe(e.id),sx:{color:`#f44336`,"&:hover":{backgroundColor:`rgba(244, 67, 54, 0.1)`}},children:`Desactivar`}):(0,T.jsx)(d,{size:`small`,startIcon:(0,T.jsx)(f,{}),onClick:()=>be(e.id),sx:{color:`#4CAF50`,"&:hover":{backgroundColor:`rgba(76, 175, 80, 0.1)`}},children:`Publicar`}),(0,T.jsx)(d,{size:`small`,startIcon:(0,T.jsx)(p,{}),onClick:()=>Se(e.id),sx:{color:`#ff6b6b`,"&:hover":{backgroundColor:`rgba(255, 107, 107, 0.1)`,color:`#ff5252`}},children:`Eliminar`})]})]})},e.id))})]}),(0,T.jsxs)(v,{open:me,onClose:X,maxWidth:`md`,fullWidth:!0,children:[(0,T.jsx)(l,{sx:{backgroundColor:`#1a1a1a`,color:`#ffd700`},children:j?.mode===`edit`?`Editar Noticia`:`Ver Noticia`}),(0,T.jsx)(a,{sx:{backgroundColor:`#0a0a0a`,pt:3},children:j?.mode===`view`?(0,T.jsxs)(b,{children:[(0,T.jsx)(h,{variant:`h5`,sx:{color:`#ffd700`,mb:2,fontWeight:700},children:j.titulo}),j.subtitulo&&(0,T.jsx)(h,{variant:`h6`,sx:{color:`#999`,mb:2},children:j.subtitulo}),j.imagen&&(0,T.jsx)(b,{component:`img`,src:j.imagen,alt:j.titulo,sx:{width:`100%`,borderRadius:2,mb:2}}),(0,T.jsx)(h,{sx:{color:`#e0e0e0`,whiteSpace:`pre-line`,lineHeight:1.8},children:j.contenido}),(0,T.jsxs)(b,{sx:{mt:3,pt:2,borderTop:`1px solid #333`},children:[(0,T.jsxs)(h,{variant:`caption`,sx:{color:`#666`,display:`block`},children:[`Autor: `,j.autor]}),(0,T.jsxs)(h,{variant:`caption`,sx:{color:`#666`,display:`block`},children:[`Sección: `,j.secciones?.nombre]}),(0,T.jsxs)(h,{variant:`caption`,sx:{color:`#666`},children:[`Estado: `,j.estado===`Edicion`?`En Edición`:j.estado===`Terminado`?`Terminado`:j.estado===`Publicado`?`Publicado`:`Desactivado`]})]})]}):(0,T.jsxs)(b,{children:[(0,T.jsx)(c,{fullWidth:!0,label:`Título`,value:F.titulo,onChange:e=>I({...F,titulo:e.target.value}),margin:`normal`,required:!0,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,T.jsx)(c,{fullWidth:!0,label:`Subtítulo`,value:F.subtitulo,onChange:e=>I({...F,subtitulo:e.target.value}),margin:`normal`,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,T.jsx)(c,{fullWidth:!0,label:`Contenido`,value:F.contenido,onChange:e=>I({...F,contenido:e.target.value}),margin:`normal`,multiline:!0,rows:6,required:!0,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,T.jsx)(c,{fullWidth:!0,label:`URL de Imagen`,value:F.imagen,onChange:e=>I({...F,imagen:e.target.value}),margin:`normal`,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,T.jsxs)(te,{fullWidth:!0,margin:`normal`,required:!0,children:[(0,T.jsx)(ie,{sx:{color:`#999`},children:`Sección`}),(0,T.jsx)(se,{value:F.categoria,label:`Sección`,onChange:e=>I({...F,categoria:e.target.value}),sx:{color:`#fff`,"& .MuiOutlinedInput-notchedOutline":{borderColor:`#333`},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:`#ffd700`}},children:O.map(e=>(0,T.jsx)(ne,{value:e.nombre,children:e.nombre},e.idseccion))})]})]})}),(0,T.jsxs)(o,{sx:{backgroundColor:`#1a1a1a`,p:2},children:[(0,T.jsx)(d,{onClick:X,sx:{color:`#999`},children:`Cerrar`}),j?.mode===`edit`&&(0,T.jsx)(d,{onClick:Ce,variant:`contained`,sx:{background:`linear-gradient(90deg, #ffd700, #ffb200)`,color:`#000`,fontWeight:700},children:`Guardar Cambios`})]})]}),(0,T.jsxs)(v,{open:ge,onClose:J,maxWidth:`sm`,fullWidth:!0,children:[(0,T.jsx)(l,{sx:{backgroundColor:`#1a1a1a`,color:`#ffd700`},children:z?`Editar Sección`:`Nueva Sección`}),(0,T.jsxs)(a,{sx:{backgroundColor:`#0a0a0a`,pt:3},children:[(0,T.jsx)(c,{fullWidth:!0,label:`Nombre de la Sección`,value:V.nombre,onChange:e=>H({...V,nombre:e.target.value}),margin:`normal`,required:!0,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,T.jsx)(c,{fullWidth:!0,label:`Descripción`,value:V.descripcion,onChange:e=>H({...V,descripcion:e.target.value}),margin:`normal`,multiline:!0,rows:3,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,T.jsx)(ae,{control:(0,T.jsx)(re,{checked:V.estado,onChange:e=>H({...V,estado:e.target.checked}),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:`#ffd700`},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:`#ffd700`}}}),label:`Activa`,sx:{mt:2,color:`#999`}})]}),(0,T.jsxs)(o,{sx:{backgroundColor:`#1a1a1a`,p:2},children:[(0,T.jsx)(d,{onClick:J,sx:{color:`#999`},children:`Cancelar`}),(0,T.jsx)(d,{onClick:_e,variant:`contained`,sx:{background:`linear-gradient(90deg, #ffd700, #ffb200)`,color:`#000`,fontWeight:700},children:z?`Guardar Cambios`:`Crear Sección`})]})]})]})};export{E as default};