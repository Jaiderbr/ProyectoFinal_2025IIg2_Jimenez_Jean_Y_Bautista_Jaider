import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{$ as t,B as n,C as r,D as i,E as ee,G as a,H as te,K as ne,N as o,Q as s,R as re,T as c,W as ie,Z as l,at as u,et as d,g as f,h as p,ht as m,it as h,j as ae,m as g,n as _,pt as v,q as y,rt as b,s as oe,t as se,tt as x,y as S}from"./mui-Ec-9_KFF.js";import{a as C}from"./vendor-CfXIGJNW.js";import"./supabase-O-LofRAx.js";import{n as w,t as ce}from"./index-D9FOe0EU.js";var T=e(m()),E=e(v()),D=()=>{let{user:e,logout:m}=ce(),v=C(),[D,O]=(0,T.useState)([]),[k,A]=(0,T.useState)([]),[j,le]=(0,T.useState)(0),[ue,M]=(0,T.useState)(!1),[N,P]=(0,T.useState)(null),[F,I]=(0,T.useState)({show:!1,message:``,type:`success`}),[L,R]=(0,T.useState)({titulo:``,subtitulo:``,contenido:``,imagen:``,categoria:``}),[z,B]=(0,T.useState)([]),[de,V]=(0,T.useState)(!1),[fe,H]=(0,T.useState)(null),[pe,U]=(0,T.useState)({nombre:``,descripcion:``,estado:!0});(0,T.useEffect)(()=>{if(!e||e.role!==`editor`){v(`/login`);return}W(),G(),K()},[e,v]);let W=async()=>{try{let{data:e,error:t}=await w.from(`posts`).select(`*`).in(`estado`,[`Terminado`,`Publicado`,`Desactivado`]).order(`fechacreacion`,{ascending:!1});if(t)throw t;if(e&&e.length>0){let{data:t}=await w.from(`secciones`).select(`*`),n=e.map(e=>{let n=t?.find(t=>t.idseccion===e.categoria);return{...e,secciones:n?{nombre:n.nombre}:null}});O(n)}else O([])}catch(e){console.error(`Error al cargar noticias:`,e),q(`Error al cargar noticias: `+e.message,`error`)}},G=async()=>{try{let{data:e,error:t}=await w.from(`secciones`).select(`*`).eq(`estado`,!0);if(t)throw t;A(e||[])}catch(e){console.error(`Error al cargar secciones:`,e)}},K=async()=>{try{let{data:e,error:t}=await w.from(`secciones`).select(`*`).order(`nombre`,{ascending:!0});if(t)throw t;B(e||[])}catch(e){console.error(`Error al cargar secciones (admin):`,e)}},q=(e,t=`success`)=>{I({show:!0,message:e,type:t}),setTimeout(()=>I({show:!1,message:``,type:`success`}),4e3)},J=(e=null)=>{e?(H(e),U({nombre:e.nombre||``,descripcion:e.descripcion||``,estado:e.estado!==!1})):(H(null),U({nombre:``,descripcion:``,estado:!0})),V(!0)},me=async e=>{try{let{error:t}=await w.from(`secciones`).update({estado:!e.estado}).eq(`idseccion`,e.idseccion);if(t)throw t;K(),G()}catch{q(`Error al cambiar estado de la sección`,`error`)}},he=async e=>{if(window.confirm(`¿Eliminar la sección "${e.nombre}"?`))try{let{count:t,error:n}=await w.from(`posts`).select(`id`,{count:`exact`}).eq(`categoria`,e.idseccion);if(n)throw n;if((t||0)>0){q(`No se puede eliminar: hay noticias asociadas a esta sección`,`error`);return}let{error:r}=await w.from(`secciones`).delete().eq(`idseccion`,e.idseccion);if(r)throw r;q(`Sección eliminada`),K(),G()}catch(e){console.error(`Error eliminando sección:`,e),q(`Error eliminando la sección`,`error`)}},Y=(e,t=`view`)=>{if(P({...e,mode:t}),t===`edit`){let t=k.find(t=>t.idseccion===e.categoria);R({titulo:e.titulo,subtitulo:e.subtitulo||``,contenido:e.contenido,imagen:e.imagen||``,categoria:t?.nombre||``})}M(!0)},X=()=>{M(!1),P(null),R({titulo:``,subtitulo:``,contenido:``,imagen:``,categoria:``})},ge=async e=>{try{let{error:t}=await w.from(`posts`).update({estado:`Publicado`,fechaactualizacion:new Date().toISOString()}).eq(`id`,e);if(t)throw console.error(`Error detallado:`,t),t;q(`Noticia publicada correctamente`),W()}catch(e){console.error(`Error al publicar:`,e),q(`Error al publicar noticia: `+(e.message||`Error desconocido`),`error`)}},_e=async e=>{try{let{error:t}=await w.from(`posts`).update({estado:`Desactivado`}).eq(`id`,e);if(t)throw t;q(`Noticia desactivada correctamente`),W()}catch(e){console.error(`Error al desactivar:`,e),q(`Error al desactivar noticia`,`error`)}},ve=async e=>{if(window.confirm(`¿Estás seguro de que deseas eliminar esta noticia? Esta acción no se puede deshacer.`))try{let{error:t}=await w.from(`posts`).delete().eq(`id`,e);if(t)throw t;q(`Noticia eliminada correctamente`),W()}catch(e){console.error(`Error al eliminar:`,e),q(`Error al eliminar noticia`,`error`)}},ye=async()=>{if(!L.titulo||!L.contenido||!L.categoria){q(`Por favor completa los campos requeridos`,`error`);return}try{let e=k.find(e=>e.nombre===L.categoria),{error:t}=await w.from(`posts`).update({titulo:L.titulo,subtitulo:L.subtitulo,contenido:L.contenido,imagen:L.imagen,categoria:e?.idseccion||null,fechaactualizacion:new Date().toISOString()}).eq(`id`,N.id);if(t)throw t;q(`Noticia actualizada correctamente`),X(),W()}catch(e){console.error(`Error al actualizar:`,e),q(`Error al actualizar noticia`,`error`)}},be=async()=>{await m(),v(`/login`)},xe=e=>{let t={Edicion:{label:`En Edición`,color:`default`,icon:null},Terminado:{label:`Terminado`,color:`info`,icon:null},Publicado:{label:`Publicado`,color:`success`,icon:(0,E.jsx)(f,{})},Desactivado:{label:`Desactivado`,color:`error`,icon:(0,E.jsx)(S,{})}}[e]||{label:`Desconocido`,color:`default`,icon:null};return(0,E.jsx)(b,{label:t.label,color:t.color,size:`small`,icon:t.icon})},Z=D.filter(e=>e.estado===`Terminado`||e.estado===`Desactivado`),Q=D.filter(e=>e.estado===`Publicado`),$=j===0?Z:Q;return(0,E.jsxs)(x,{className:`panel-editor`,children:[(0,E.jsxs)(x,{className:`panel-header`,children:[(0,E.jsxs)(x,{className:`header-content`,children:[(0,E.jsx)(_,{sx:{fontSize:40,color:`#ffd700`}}),(0,E.jsxs)(x,{children:[(0,E.jsx)(h,{variant:`h4`,sx:{color:`#ffd700`,fontWeight:700},children:`Panel de Editor`}),(0,E.jsxs)(h,{variant:`body2`,sx:{color:`#999`},children:[`Bienvenido, `,e?.nombre]})]})]}),(0,E.jsx)(d,{variant:`outlined`,startIcon:(0,E.jsx)(oe,{}),onClick:be,sx:{borderColor:`#ffd700`,color:`#ffd700`,"&:hover":{borderColor:`#ffed4e`,backgroundColor:`rgba(255, 215, 0, 0.1)`}},children:`Cerrar Sesión`})]}),F.show&&(0,E.jsx)(u,{severity:F.type,sx:{mb:3},children:F.message}),(0,E.jsxs)(x,{className:`panel-content`,children:[(0,E.jsxs)(ee,{value:j,onChange:(e,t)=>le(t),variant:`scrollable`,scrollButtons:`auto`,allowScrollButtonsMobile:!0,sx:{mb:3,minHeight:44,"& .MuiTab-root":{color:`#999`,fontWeight:600,minWidth:`fit-content`,px:2,minHeight:44},"& .Mui-selected":{color:`#ffd700`},"& .MuiTabs-indicator":{backgroundColor:`#ffd700`},"& .MuiTabs-scrollButtons":{color:`#ffd700`,alignSelf:`center`,height:44}},children:[(0,E.jsx)(i,{label:`Pendientes (${Z.length})`}),(0,E.jsx)(i,{label:`Publicadas (${Q.length})`}),(0,E.jsx)(i,{label:`Secciones (${z.length})`})]}),j===2?(0,E.jsxs)(x,{children:[(0,E.jsxs)(x,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:2},children:[(0,E.jsx)(h,{variant:`h6`,sx:{color:`#ffd700`,fontWeight:700},children:`Administrar Secciones`}),(0,E.jsx)(d,{variant:`contained`,startIcon:(0,E.jsx)(r,{}),onClick:()=>J(null),sx:{background:`linear-gradient(90deg, #ffd700, #ffb200)`,color:`#000`,fontWeight:700,"&:hover":{background:`linear-gradient(90deg, #ffed4e, #ffd700)`}},children:`Nueva sección`})]}),z.length===0?(0,E.jsx)(h,{sx:{color:`#999`,textAlign:`center`,py:4},children:`No hay secciones registradas`}):(0,E.jsx)(n,{container:!0,spacing:3,className:`panel-grid`,children:z.map(e=>(0,E.jsx)(n,{item:!0,xs:12,md:6,lg:4,sx:{display:`flex`},children:(0,E.jsxs)(t,{className:`noticia-card`,sx:{width:`100%`,maxWidth:380,mx:`auto`},children:[(0,E.jsxs)(l,{children:[(0,E.jsx)(x,{sx:{display:`flex`,justifyContent:`space-between`,alignItems:`center`,mb:1},children:(0,E.jsx)(b,{label:e.estado?`Activa`:`Inactiva`,color:e.estado?`success`:`default`,size:`small`})}),(0,E.jsx)(h,{variant:`h6`,sx:{color:`#ffd700`,fontWeight:700,mb:1},children:e.nombre}),(0,E.jsx)(h,{variant:`body2`,sx:{color:`#999`,mb:1},children:e.descripcion||`Sin descripción`})]}),(0,E.jsxs)(s,{sx:{gap:1,flexWrap:`wrap`},children:[(0,E.jsx)(d,{size:`small`,startIcon:(0,E.jsx)(g,{}),onClick:()=>J(e),sx:{color:`#4CAF50`,"&:hover":{backgroundColor:`rgba(76, 175, 80, 0.1)`}},children:`Editar`}),(0,E.jsx)(d,{size:`small`,startIcon:e.estado?(0,E.jsx)(S,{}):(0,E.jsx)(f,{}),onClick:()=>me(e),sx:{color:e.estado?`#f44336`:`#4CAF50`,"&:hover":{backgroundColor:e.estado?`rgba(244, 67, 54, 0.1)`:`rgba(76, 175, 80, 0.1)`}},children:e.estado?`Desactivar`:`Activar`}),(0,E.jsx)(d,{size:`small`,startIcon:(0,E.jsx)(p,{}),onClick:()=>he(e),sx:{color:`#ff6b6b`,"&:hover":{backgroundColor:`rgba(255, 107, 107, 0.1)`,color:`#ff5252`}},children:`Eliminar`})]})]})},e.idseccion))})]}):(0,E.jsx)(n,{container:!0,spacing:3,className:`panel-grid`,children:$.length===0?(0,E.jsx)(n,{item:!0,xs:12,children:(0,E.jsx)(h,{sx:{color:`#999`,textAlign:`center`,py:4},children:j===0?`No hay noticias pendientes`:`No hay noticias publicadas`})}):$.map(e=>(0,E.jsx)(n,{item:!0,xs:12,md:6,lg:4,sx:{display:`flex`},children:(0,E.jsxs)(t,{className:`noticia-card`,sx:{width:`100%`,maxWidth:380,mx:`auto`},children:[(0,E.jsxs)(l,{children:[(0,E.jsxs)(x,{sx:{display:`flex`,justifyContent:`center`,alignItems:`center`,gap:2,mb:1},children:[xe(e.estado),(0,E.jsx)(b,{label:e.secciones?.nombre||`Sin sección`,size:`small`,sx:{backgroundColor:`#333`,color:`#ffd700`}})]}),(0,E.jsx)(h,{variant:`h6`,sx:{color:`#ffd700`,fontWeight:700,mb:1},children:e.titulo}),(0,E.jsx)(h,{variant:`body2`,sx:{color:`#999`,mb:1},children:e.subtitulo}),(0,E.jsxs)(h,{variant:`caption`,sx:{color:`#666`,display:`block`},children:[`Autor: `,e.autor]}),(0,E.jsxs)(h,{variant:`caption`,sx:{color:`#666`},children:[`Creada: `,new Date(e.fechacreacion).toLocaleDateString()]})]}),(0,E.jsxs)(s,{sx:{gap:1,flexWrap:`wrap`},children:[(0,E.jsx)(d,{size:`small`,startIcon:(0,E.jsx)(se,{}),onClick:()=>Y(e,`view`),sx:{color:`#ffd700`,"&:hover":{backgroundColor:`rgba(255, 215, 0, 0.1)`}},children:`Ver`}),(0,E.jsx)(d,{size:`small`,startIcon:(0,E.jsx)(g,{}),onClick:()=>Y(e,`edit`),sx:{color:`#4CAF50`,"&:hover":{backgroundColor:`rgba(76, 175, 80, 0.1)`}},children:`Editar`}),e.estado===`Publicado`?(0,E.jsx)(d,{size:`small`,startIcon:(0,E.jsx)(S,{}),onClick:()=>_e(e.id),sx:{color:`#f44336`,"&:hover":{backgroundColor:`rgba(244, 67, 54, 0.1)`}},children:`Desactivar`}):(0,E.jsx)(d,{size:`small`,startIcon:(0,E.jsx)(f,{}),onClick:()=>ge(e.id),sx:{color:`#4CAF50`,"&:hover":{backgroundColor:`rgba(76, 175, 80, 0.1)`}},children:`Publicar`}),(0,E.jsx)(d,{size:`small`,startIcon:(0,E.jsx)(p,{}),onClick:()=>ve(e.id),sx:{color:`#ff6b6b`,"&:hover":{backgroundColor:`rgba(255, 107, 107, 0.1)`,color:`#ff5252`}},children:`Eliminar`})]})]})},e.id))})]}),(0,E.jsxs)(y,{open:ue,onClose:X,maxWidth:`md`,fullWidth:!0,children:[(0,E.jsx)(ie,{sx:{backgroundColor:`#1a1a1a`,color:`#ffd700`},children:N?.mode===`edit`?`Editar Noticia`:`Ver Noticia`}),(0,E.jsx)(a,{sx:{backgroundColor:`#0a0a0a`,pt:3},children:N?.mode===`view`?(0,E.jsxs)(x,{children:[(0,E.jsx)(h,{variant:`h5`,sx:{color:`#ffd700`,mb:2,fontWeight:700},children:N.titulo}),N.subtitulo&&(0,E.jsx)(h,{variant:`h6`,sx:{color:`#999`,mb:2},children:N.subtitulo}),N.imagen&&(0,E.jsx)(x,{component:`img`,src:N.imagen,alt:N.titulo,sx:{width:`100%`,borderRadius:2,mb:2}}),(0,E.jsx)(h,{sx:{color:`#e0e0e0`,whiteSpace:`pre-line`,lineHeight:1.8},children:N.contenido}),(0,E.jsxs)(x,{sx:{mt:3,pt:2,borderTop:`1px solid #333`},children:[(0,E.jsxs)(h,{variant:`caption`,sx:{color:`#666`,display:`block`},children:[`Autor: `,N.autor]}),(0,E.jsxs)(h,{variant:`caption`,sx:{color:`#666`,display:`block`},children:[`Sección: `,N.secciones?.nombre]}),(0,E.jsxs)(h,{variant:`caption`,sx:{color:`#666`},children:[`Estado: `,N.estado===`Edicion`?`En Edición`:N.estado===`Terminado`?`Terminado`:N.estado===`Publicado`?`Publicado`:`Desactivado`]})]})]}):(0,E.jsxs)(x,{children:[(0,E.jsx)(c,{fullWidth:!0,label:`Título`,value:L.titulo,onChange:e=>R({...L,titulo:e.target.value}),margin:`normal`,required:!0,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,E.jsx)(c,{fullWidth:!0,label:`Subtítulo`,value:L.subtitulo,onChange:e=>R({...L,subtitulo:e.target.value}),margin:`normal`,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,E.jsx)(c,{fullWidth:!0,label:`Contenido`,value:L.contenido,onChange:e=>R({...L,contenido:e.target.value}),margin:`normal`,multiline:!0,rows:6,required:!0,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,E.jsx)(c,{fullWidth:!0,label:`URL de Imagen`,value:L.imagen,onChange:e=>R({...L,imagen:e.target.value}),margin:`normal`,sx:{"& .MuiInputLabel-root":{color:`#999`},"& .MuiOutlinedInput-root":{color:`#fff`,"& fieldset":{borderColor:`#333`},"&:hover fieldset":{borderColor:`#ffd700`}}}}),(0,E.jsxs)(te,{fullWidth:!0,margin:`normal`,required:!0,children:[(0,E.jsx)(re,{sx:{color:`#999`},children:`Sección`}),(0,E.jsx)(ae,{value:L.categoria,label:`Sección`,onChange:e=>R({...L,categoria:e.target.value}),sx:{color:`#fff`,"& .MuiOutlinedInput-notchedOutline":{borderColor:`#333`},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:`#ffd700`}},children:k.map(e=>(0,E.jsx)(o,{value:e.nombre,children:e.nombre},e.idseccion))})]})]})}),(0,E.jsxs)(ne,{sx:{backgroundColor:`#1a1a1a`,p:2},children:[(0,E.jsx)(d,{onClick:X,sx:{color:`#999`},children:`Cerrar`}),N?.mode===`edit`&&(0,E.jsx)(d,{onClick:ye,variant:`contained`,sx:{background:`linear-gradient(90deg, #ffd700, #ffb200)`,color:`#000`,fontWeight:700},children:`Guardar Cambios`})]})]})]})};export{D as default};