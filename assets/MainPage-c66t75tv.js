import{a as e}from"./rolldown-runtime-Cn8xt2Gj.js";import{$ as t,H as n,L as r,M as i,N as a,O as o,Q as ee,R as s,T as c,V as l,Z as u,_ as d,et as f,ht as p,it as m,j as h,k as g,l as _,p as v,pt as y,tt as b,u as x,x as S,z as C}from"./mui-Ec-9_KFF.js";import{n as w}from"./vendor-CfXIGJNW.js";import"./supabase-O-LofRAx.js";import{n as T,t as E}from"./index-CxN0Tboc.js";import{t as D}from"./CardsNews-BW7bhnPN.js";var O=e(p()),k=e(y()),A=({nombre:e,descripcion:t,estado:n,onClick:r})=>{let i=n!==!1;return(0,k.jsxs)(`div`,{className:`section-card ${i?`active`:`inactive`}`,onClick:r,style:{cursor:r?`pointer`:`default`},children:[(0,k.jsx)(`div`,{className:`left-border ${i?`left-active`:`left-inactive`}`}),(0,k.jsxs)(`div`,{className:`card-content`,children:[(0,k.jsxs)(`div`,{className:`card-header`,children:[(0,k.jsx)(`span`,{className:`icon`,children:``}),(0,k.jsx)(`h3`,{className:`section-title`,children:e})]}),(0,k.jsx)(`p`,{className:`description`,children:t||`Sin descripci贸n`})]})]})},j=({onSectionClick:e})=>{let[t,n]=(0,O.useState)([]);return(0,O.useEffect)(()=>{(async()=>{try{let{data:e,error:t}=await T.from(`secciones`).select(`*`).eq(`estado`,!0);if(t)throw t;n(e||[])}catch(e){console.error(`Error al obtener secciones:`,e)}})()},[]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(`header`,{className:`header`,children:(0,k.jsxs)(`div`,{className:`header-container`,children:[(0,k.jsx)(`div`,{className:`logo`,children:(0,k.jsxs)(w,{to:`/`,children:[(0,k.jsx)(`span`,{className:`logo-icon`,children:``}),(0,k.jsxs)(`span`,{className:`logo-text`,children:[(0,k.jsx)(`span`,{className:`logo-news`,children:`NEWS`}),(0,k.jsx)(`span`,{className:`logo-portal`,children:`PORTAL`})]})]})}),(0,k.jsx)(`div`,{className:`auth-buttons`,children:(0,k.jsx)(w,{to:`/login`,className:`btn login-btn`,children:`Iniciar Sesi贸n`})})]})}),(0,k.jsxs)(`div`,{className:`sections-container`,children:[(0,k.jsxs)(`div`,{className:`left-panel`,children:[(0,k.jsx)(`h2`,{children:` View Sections`}),(0,k.jsx)(`p`,{children:`Administra las secciones del portal de noticias.`})]}),(0,k.jsx)(`div`,{className:`right-panel`,children:(0,k.jsx)(`div`,{className:`sections-grid`,children:t.length>0?t.map(t=>(0,k.jsx)(A,{nombre:t.nombre,descripcion:t.descripcion,estado:t.estado,onClick:()=>e&&e(t.nombre)},t.idseccion)):(0,k.jsx)(`p`,{className:`no-data`,children:`No hay secciones registradas.`})})})]})]})},M=()=>(0,k.jsxs)(`footer`,{className:`footer`,children:[(0,k.jsxs)(`div`,{className:`footer-container`,children:[(0,k.jsxs)(`div`,{className:`footer-about`,children:[(0,k.jsx)(`h2`,{children:` NewsPortal`}),(0,k.jsx)(`p`,{children:`Tu fuente confiable de noticias actualizadas sobre tecnolog铆a, deportes, cultura y m谩s.`})]}),(0,k.jsxs)(b,{className:`footer-section`,children:[(0,k.jsx)(m,{variant:`h6`,className:`footer-title simpsons-text`,children:`Authors`}),(0,k.jsxs)(b,{className:`authors-grid`,children:[(0,k.jsxs)(b,{className:`author-card`,children:[(0,k.jsx)(m,{variant:`body1`,className:`author-name simpsons-text`,children:`Jaider Bautista Rodriguez`}),(0,k.jsxs)(b,{className:`author-links`,children:[(0,k.jsxs)(r,{href:`mailto:jaid.bautista@udla.edu.co`,className:`author-link`,children:[(0,k.jsx)(v,{sx:{fontSize:16,mr:.5}}),`Contact`]}),(0,k.jsxs)(r,{href:`https://github.com/Jaiderbr`,target:`_blank`,rel:`noreferrer`,className:`author-link`,children:[(0,k.jsx)(_,{sx:{fontSize:16,mr:.5}}),`GitHub`]})]})]}),(0,k.jsxs)(b,{className:`author-card`,children:[(0,k.jsx)(m,{variant:`body1`,className:`author-name simpsons-text`,children:`Jean Carlos Jimenez Ortega`}),(0,k.jsxs)(b,{className:`author-links`,children:[(0,k.jsxs)(r,{href:`mailto:jean.jimenez@udla.edu.co`,className:`author-link`,children:[(0,k.jsx)(v,{sx:{fontSize:16,mr:.5}}),`Contact`]}),(0,k.jsxs)(r,{href:`https://github.com/Jeank-J`,target:`_blank`,rel:`noreferrer`,className:`author-link`,children:[(0,k.jsx)(_,{sx:{fontSize:16,mr:.5}}),`GitHub`]})]})]})]})]})]}),(0,k.jsx)(`div`,{className:`footer-bottom`,children:(0,k.jsxs)(`p`,{children:[`漏 `,new Date().getFullYear(),` NewsPortal. Todos los derechos reservados.`]})})]}),N=()=>{let e=`BucketNews`,[r,p]=(0,O.useState)(!1),[_,v]=(0,O.useState)({autor:``,subtitulo:``,categoria:``,contenido:``,imagen:``,estado:``,titulo:``,destacado:!1}),[y,w]=(0,O.useState)(``),[A,N]=(0,O.useState)([]),[P,F]=(0,O.useState)(!1),[I,L]=(0,O.useState)({}),[R,z]=(0,O.useState)(null),[B,V]=(0,O.useState)(``),[H,U]=(0,O.useState)(0),[W,G]=(0,O.useState)([]),[K,q]=(0,O.useState)({type:`all`,value:null}),[J,Y]=(0,O.useState)(!1),{user:X}=E();(0,O.useEffect)(()=>{(async()=>{try{let{data:e,error:t}=await T.from(`posts`).select(`*`).eq(`estado`,`Publicado`).order(`fechacreacion`,{ascending:!1});if(t)throw t;N(e||[])}catch(e){console.error(`Error al obtener posts:`,e)}})(),(async()=>{try{let{data:e,error:t}=await T.from(`secciones`).select(`*`);if(t)throw t;G((e||[]).filter(e=>e.estado!==!1))}catch(e){console.error(`Error al obtener secciones:`,e)}})();let e=()=>{Y(window.scrollY>300)};return window.addEventListener(`scroll`,e),()=>window.removeEventListener(`scroll`,e)},[]);let Z=e=>{v({..._,[e.target.name]:e.target.value})},Q=e=>{let t=e.target.files?.[0];if(!t)return;z(t);let n=URL.createObjectURL(t);V(n),v(e=>({...e,imagen:``}))},te=()=>{let e={};return _.titulo.trim()||(e.Title=`El t铆tulo es obligatorio`),_.contenido.trim()||(e.Content=`El contenido es obligatorio`),e},$=async(e,t=25e3,n=`operaci贸n`)=>{let r,i=new Promise((e,i)=>{r=setTimeout(()=>{i(Error(`Tiempo de espera excedido (${n})`))},t)});try{return await Promise.race([e,i])}finally{clearTimeout(r)}},ne=async t=>{t?.preventDefault?.(),w(``),L({});let n=te();if(Object.keys(n).length){L(n),w(`Por favor corrige los campos marcados.`);return}try{F(!0);let t=_.imagen;if(R){console.log(`[upload] iniciando subida a Supabase Storage`,{bucket:e});let n=`posts/${Date.now()}_${R.name}`;await $(T.storage.from(e).upload(n,R,{cacheControl:`3600`,upsert:!1}),25e3,`subida de imagen`);let{data:r}=T.storage.from(e).getPublicUrl(n);t=r?.publicUrl||``,U(100),console.log(`[upload] subida completa, url:`,t)}console.log(`[supabase] creando registro en posts...`);let n=new Date().toISOString(),r=W.find(e=>e.nombre===_.categoria),i={autor:_.autor||X?.nombre||`An贸nimo`,titulo:_.titulo,subtitulo:_.subtitulo||``,categoria:r?.idseccion||null,contenido:_.contenido,imagen:t||``,estado:_.estado===`publicado`,destacado:!!_.destacado,fechacreacion:n,fechaactualizacion:n},{data:a,error:o}=await $(T.from(`posts`).insert([i]).select().single(),2e4,`registro de la noticia`);if(o)throw o;console.log(`Post guardado:`,a?.id),v({autor:``,subtitulo:``,categoria:``,contenido:``,imagen:``,estado:``,titulo:``,destacado:!1}),z(null),V(``),U(0),p(!1),N(e=>[...e,a||{...i}])}catch(e){console.error(`[submit] Error:`,e),w(e?.message||`Error inesperado durante el guardado.`)}finally{F(!1)}},re=e=>{q({type:`section`,value:e}),setTimeout(()=>{let e=document.querySelector(`.container`);if(!e)return;let t=document.querySelector(`.header`),n=t?t.getBoundingClientRect().height:0,r=e.getBoundingClientRect().top+window.pageYOffset-n-16;window.scrollTo({top:r<0?0:r,behavior:`smooth`})},60)},ie=()=>{window.scrollTo({top:0,behavior:`smooth`})};return(0,k.jsxs)(`div`,{className:`mainmain`,children:[(0,k.jsx)(j,{onSectionClick:re}),(0,k.jsxs)(`main`,{children:[r&&(0,k.jsx)(b,{className:`form-card-wrapper`,children:(0,k.jsxs)(t,{elevation:6,className:`form-card`,sx:{backgroundColor:`#1a1a1a`,border:`2px solid #ffd700`,boxShadow:`0 8px 32px rgba(255, 215, 0, 0.15)`},children:[(0,k.jsxs)(u,{children:[(0,k.jsxs)(g,{spacing:1,sx:{mb:2},children:[(0,k.jsx)(m,{variant:`h5`,component:`div`,sx:{color:`#ffd700`,fontWeight:600},children:`Nueva noticia`}),(0,k.jsx)(m,{variant:`body2`,sx:{color:`#c0c0c0`},children:`Completa los campos para publicar o guardar como borrador.`}),y&&(0,k.jsx)(m,{variant:`body2`,color:`error`,children:y})]}),(0,k.jsxs)(g,{spacing:2,sx:{"& > *":{width:`100%`},"& .MuiTextField-root":{"& .MuiOutlinedInput-root":{color:`#f0f0f0`,backgroundColor:`#0a0a0a`,"& fieldset":{borderColor:`#444`},"&:hover fieldset":{borderColor:`#ffd700`},"&.Mui-focused fieldset":{borderColor:`#ffd700`,borderWidth:`2px`}},"& .MuiInputLabel-root":{color:`#c0c0c0`},"& .MuiInputLabel-root.Mui-focused":{color:`#ffd700`}}},children:[(0,k.jsx)(c,{label:`Autor`,name:`autor`,value:_.autor,onChange:Z,fullWidth:!0}),(0,k.jsx)(c,{label:`T铆tulo`,name:`titulo`,value:_.titulo,onChange:Z,error:!!I.Title,helperText:I.Title,required:!0,fullWidth:!0}),(0,k.jsx)(c,{label:`Subt铆tulo`,name:`subtitulo`,value:_.subtitulo,onChange:Z,fullWidth:!0}),(0,k.jsxs)(n,{fullWidth:!0,size:`medium`,sx:{"& .MuiOutlinedInput-root":{color:`#f0f0f0`,backgroundColor:`#0a0a0a`,"& fieldset":{borderColor:`#444`},"&:hover fieldset":{borderColor:`#ffd700`},"&.Mui-focused fieldset":{borderColor:`#ffd700`,borderWidth:`2px`}},"& .MuiInputLabel-root":{color:`#c0c0c0`},"& .MuiInputLabel-root.Mui-focused":{color:`#ffd700`},"& .MuiSvgIcon-root":{color:`#ffd700`}},children:[(0,k.jsx)(s,{id:`section-label`,children:`Secci贸n`}),(0,k.jsxs)(h,{labelId:`section-label`,label:`Secci贸n`,name:`categoria`,value:_.categoria,onChange:Z,input:(0,k.jsx)(i,{label:`Secci贸n`,startAdornment:(0,k.jsx)(C,{position:`start`,children:(0,k.jsx)(d,{fontSize:`small`})})}),MenuProps:{PaperProps:{sx:{backgroundColor:`#1a1a1a`,border:`1px solid #444`,"& .MuiMenuItem-root":{color:`#f0f0f0`,"&:hover":{backgroundColor:`#2a2a2a`},"&.Mui-selected":{backgroundColor:`#ffd70020`,"&:hover":{backgroundColor:`#ffd70030`}}}}}},children:[(0,k.jsx)(a,{value:``,children:(0,k.jsx)(`em`,{children:`Seleccione una secci贸n`})}),W.map(e=>(0,k.jsx)(a,{value:e.nombre,children:e.nombre},e.id))]})]}),(0,k.jsxs)(n,{fullWidth:!0,size:`medium`,sx:{"& .MuiOutlinedInput-root":{color:`#f0f0f0`,backgroundColor:`#0a0a0a`,"& fieldset":{borderColor:`#444`},"&:hover fieldset":{borderColor:`#ffd700`},"&.Mui-focused fieldset":{borderColor:`#ffd700`,borderWidth:`2px`}},"& .MuiInputLabel-root":{color:`#c0c0c0`},"& .MuiInputLabel-root.Mui-focused":{color:`#ffd700`},"& .MuiSvgIcon-root":{color:`#ffd700`}},children:[(0,k.jsx)(s,{id:`state-label`,children:`Estado`}),(0,k.jsxs)(h,{labelId:`state-label`,label:`Estado`,name:`estado`,value:_.estado,onChange:Z,input:(0,k.jsx)(i,{label:`Estado`,startAdornment:(0,k.jsx)(C,{position:`start`,children:(0,k.jsx)(x,{fontSize:`small`})})}),MenuProps:{PaperProps:{sx:{backgroundColor:`#1a1a1a`,border:`1px solid #444`,"& .MuiMenuItem-root":{color:`#f0f0f0`,"&:hover":{backgroundColor:`#2a2a2a`},"&.Mui-selected":{backgroundColor:`#ffd70020`,"&:hover":{backgroundColor:`#ffd70030`}}}}}},children:[(0,k.jsx)(a,{value:``,children:(0,k.jsx)(`em`,{children:`Seleccionar estado`})}),(0,k.jsx)(a,{value:`publicado`,children:`Publicado`}),(0,k.jsx)(a,{value:`borrador`,children:`Borrador`})]})]}),(0,k.jsx)(l,{control:(0,k.jsx)(o,{checked:!!_.destacado,onChange:e=>v(t=>({...t,destacado:e.target.checked})),sx:{"& .MuiSwitch-switchBase.Mui-checked":{color:`#ffd700`},"& .MuiSwitch-switchBase.Mui-checked + .MuiSwitch-track":{backgroundColor:`#ffd700`}}}),label:`Destacado`,sx:{color:`#f0f0f0`}}),(0,k.jsx)(c,{label:`Contenido`,name:`contenido`,value:_.contenido,onChange:Z,error:!!I.Content,helperText:I.Content,required:!0,fullWidth:!0,multiline:!0,minRows:4}),(0,k.jsxs)(g,{direction:{xs:`column`,sm:`row`},spacing:2,alignItems:`center`,children:[(0,k.jsxs)(f,{variant:`outlined`,component:`label`,disabled:P,sx:{borderColor:`#ffd700`,color:`#ffd700`,"&:hover":{borderColor:`#ffaa00`,backgroundColor:`#ffd70010`}},children:[`Seleccionar imagen`,(0,k.jsx)(`input`,{type:`file`,accept:`image/*`,hidden:!0,onChange:Q})]}),(0,k.jsx)(m,{variant:`body2`,sx:{color:`#c0c0c0`},children:R?R.name:`No hay archivo seleccionado`}),H>0&&H<100&&(0,k.jsxs)(m,{variant:`caption`,sx:{color:`#ffd700`},children:[`Subiendo: `,H,`%`]})]}),(0,k.jsx)(b,{children:B||_.imagen?(0,k.jsx)(b,{className:`img-preview-wrapper`,children:(0,k.jsx)(`img`,{src:B||_.imagen,alt:`Vista previa`,className:`img-preview`,onError:e=>e.currentTarget.style.display=`none`})}):(0,k.jsx)(m,{variant:`caption`,color:`text.secondary`,children:`Vista previa de imagen`})})]})]}),(0,k.jsxs)(ee,{sx:{justifyContent:`flex-end`},children:[(0,k.jsx)(f,{variant:`text`,onClick:()=>{p(!1),w(``),L({}),z(null),V(``),U(0)},disabled:P,sx:{color:`#c0c0c0`,"&:hover":{backgroundColor:`#2a2a2a`}},children:`Cancelar`}),(0,k.jsx)(f,{variant:`contained`,onClick:ne,sx:{backgroundColor:`#ffd700`,color:`#0a0a0a`,fontWeight:600,"&:hover":{backgroundColor:`#ffaa00`}},disabled:P,children:P?`Guardando...`:`Guardar noticia`})]})]})}),(0,k.jsx)(`div`,{className:`container`,children:(()=>{let e=e=>(e||``).toString().toLowerCase(),t=new Set((W||[]).filter(e=>e.estado!==!1).map(e=>e.idseccion)),n=(A||[]).filter(e=>e&&e.estado===`Publicado`&&t.has(e.categoria)).filter(t=>{if(K.type===`section`){let n=W.find(e=>e.idseccion===t.categoria)?.nombre;return e(n)===e(K.value)}return!0}).sort((e,t)=>{let n=e=>{let t=e.fechacreacion||e.fechapublicacion||e.fechaPublicacion||e.creado_en||e.fechaCreacion||e.createdAt||e.created_at;if(!t)return 0;if(typeof t==`object`&&t?.seconds)return t.seconds*1e3;let n=Date.parse(t);return Number.isNaN(n)?0:n};return n(t)-n(e)});return n.length?n.map(e=>{let t=W.find(t=>t.idseccion===e.categoria),n={...e,seccion_nombre:t?.nombre};return(0,k.jsx)(D,{post:n,clickable:!0},e.id)}):(0,k.jsx)(m,{variant:`body2`,color:`text.secondary`,children:`No hay noticias para mostrar.`})})()})]}),(0,k.jsx)(M,{}),J&&(0,k.jsx)(f,{onClick:ie,variant:`contained`,sx:{position:`fixed`,bottom:24,right:24,borderRadius:`50%`,minWidth:56,height:56,backgroundColor:`#ffd700`,color:`#0a0a0a`,boxShadow:`0 4px 20px rgba(255, 215, 0, 0.4)`,zIndex:1e3,"&:hover":{backgroundColor:`#ffaa00`,transform:`scale(1.1)`,transition:`transform 0.2s ease`,boxShadow:`0 6px 24px rgba(255, 215, 0, 0.6)`}},"aria-label":`Volver arriba`,children:(0,k.jsx)(S,{})})]})};export{N as default};